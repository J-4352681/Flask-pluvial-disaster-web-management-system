{% extends "generic/base.html" %}

{% block title %}Usuarios{% endblock %}

{% block navbar %}
    {% include "generic/navbar.html" %} 
{% endblock %}

{% block content %}

    <section>
        {% with titulo_apartado="Usuarios", subtitulo_apartado="Listado y edición de usuarios del sistema" %}
            {% include "generic/generic_content.html" %}
        {% endwith %}

        <div class="row mx-3">
            <div class="col">
                <div class="row">
                    <div class="col-6">
                        <div class="row">
                            <div class="col">
                            <a class="btn btn-primary" href="{{url_for("user_new")}}">+ Crear usuario</a>
                            </div>
                            <div class="col">
                            <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#user-filter">Filtrar</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-6"></div>
                </div>
                <div class="row">
                <table class="col table table-hover h-100">
                    <thead class="row">
                        <tr class="row">
                        <th class="col">Username</th>
                        <th class="col">Email</th>
                        <th class="col">Nombre</th>
                        <th class="col">Apellido</th>
                        <th class="col">Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="row">
                        {% for user in users.items %}
                            {% if user.active == 1 %}
                                <tr class="row">
                            {% else %}
                                <tr class="row blocked">
                            {% endif %}
                                <td class="col">{{ user.username }}</td>
                                <td class="col">{{ user.email }}</td>
                                <td class="col">{{ user.first_name }}</td>
                                <td class="col">{{ user.last_name }}</td>
                                <td class="col">
                                    <a href="{{ url_for('user_modify', user_id=user.id)}}" title="Editar"><ion-icon name="pencil-outline"></ion-icon></a>
                                    {% if user.active == 1 %}
                                        <a onclick="return confirm('¿Esta seguro que quiere bloquear a este usuario?')" href="{{ url_for('user_block', user_id=user.id)}}" title="Bloquear"><ion-icon name="close-outline"></ion-icon></a>
                                    {% else %}
                                        <a href="{{ url_for('user_unblock', user_id=user.id)}}" title="Desbloquear"><ion-icon name="checkmark-outline"></ion-icon></a>
                                    {% endif %}
                                    <a onclick="return confirm('¿Esta seguro que quiere eliminar a este usuario?')" href="{{ url_for('user_delete', user_id=user.id)}}" title="Borrar usuario"><ion-icon name="trash-outline"></ion-icon></a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                    </table>
                    <div class="pagination row">
                    {% if users.has_prev %}
                        <div class="col mx-auto">
                            <a href="{{url_for('user_index', page=users.prev_num)}}">Anterior</a>
                        </div>
                    {% endif %}
                    <div class="col mx-auto">
                        {% if users.items %}
                            <p>Viendo página {{users.page}} de  {{(-(-users.total // users.per_page))}}</p>
                        {% else %}
                            <p>La tabla está vacía</p>
                        {% endif %}
                    </div>
                    {% if users.has_next %}
                        <div class="col mx-auto">
                            <a href="{{url_for('user_index', page=users.next_num)}}">Siguiente</a>
                        </div>
                    {% endif %}
                </div>
                </div>
            </div>
    
            {% with fields=filters %}
                {% include "user/filter.html" %}
            {% endwith %}
        </div>
    </section>  

{% endblock %}
